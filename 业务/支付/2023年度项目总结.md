# Wooshpay

​	

## 一、openapi

### 1、渠道对接

#### 1）支付渠道

​	**参与对接的支付渠道数量**

- ​	Paydibs：马来西亚

- ​	Dana：印度尼西亚

- ​	Finaro：卡渠道

- ​	Alipayplus：

- ​	unlimint：

- ​	tazapay：

- ​	qiwi：俄罗斯（支付方式：card、qiwi）

- ​	waffo：（支付方式gcash）

-   dragonpay：（支付方式gcash）

-   cybersource

  

**一年来渠道对接发生的变化**

-渠道请求记录

​		每一次向渠道发起的请求都会记录到oa_channel_request表

-charge流转

​		每向渠道发起一次支付请求对应一笔charge，原本是先向渠道发起请求，返回chargeId再由openapi创建。

现改变为在openapi侧创建charge，提供chargeId给金融交换再去向渠道发起做支付请求，确保每一笔在渠道侧的订单都有对应的charge可查。

-主动订单同步

​	

**支付方式类型**

APM

​	电子钱包

​	银行转账

card

​	API支付、checkout、3ds实现

​	setup

**要注意的问题**

​	chargeId统一格式

​	支付状态回调处理

**难点：**

​	card 3ds的实现

​	setup功能

​	支付成功率较低排查



#### 2）发卡渠道

​	airwallex：提供给教育缴费使用了，openapi以上测试

​	pingpong：正在对接



**问题：**

金融交换跟openapi有没有必要拆分，拆分的话两个系统一般用什么通讯

​	没必要，除非合并在一块影响了开发进展，或者两个系统的人员很难合作，或者性能上有必要拆分

支付成功率较低排查

​	把失败的订单拉取处理，分类统计失败的原因，有问题就修复，没有就反映给业务人员，证明无技术上的问题	

问题总结：

​	charge没有收到渠道的失败回调，就一直pending，需要跟业务人员定一个关单的时间，不应该一直pending





## 二、风控系统

概览：解决了openapi风控从无到有的问题，已支持商户账号颗粒度下的card风控，包括card号，card bin交易额度，交易频率的限制，ip支付速率限制，退款速率限制，拒付数限制。

刚开始的硬编码，后续选择了阿里开源的QLExpress做风控

目前QLExpress实现的风控以投入使用，有商户账号颗粒度的card bin block，交易限额的风控功能，结合之前的硬编码规则一起在线上。后续硬编码的规则逐步下线



问题：

风控技术选型要考虑那些方面

支付的风控系统后续要做成什么样的

问题总结：

目前做的是很浅的一层，后续迭代需要和业务人员一起讨论

请教做过风控的人员



## 三、报表系统

出每日交易报表，每日物流报表给对账人员；提供处理后的渠道侧报表给个别商户；统计各个商户的支付成功率



### 	1、商户每日报表

​		维护商户每日报表，排查有疑问的订单

​		每日物流报表开发，有物流投递的商户，在昨天签收的订单今天要出报表



​		系统改善：

  - 给系统建库，建每日商户的表，原来的系统没有数据库，强依赖缓存，甚至每日报表的商户存在缓存里

  - 每日报表内存溢出bug修复，拉取商户交易进行分页查询，数据分批处理，原来的数据处理是一次性的，出现每日交易数量大的商户就会内存溢出，系统崩溃

    

### 	2、提供给商户的卡支付渠道（Finaro）报表处理

​		这是一个定时任务，功能是从SFTP拉取card渠道的每日报表，对报表做一些处理，处理后的数据用发到我们的SFTP上提供给商户，也在企业微信群给业务人员发一份

​		

​		问题：

​		大企业的报表系统是什么样的，主要有什么功能，

问题总结：

​	需要建立一个测试环境，要不然发生产可能会有问题

​	对账，给商户看的，给老板、经理看的统计，

​	评估每日报表拉取数据的压力，是否需要统计的交易数据会隔离到新的库，避免核心交易系统造成压力

​	